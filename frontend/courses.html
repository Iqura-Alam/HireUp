<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HireUp - Browse Courses</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .course-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .course-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .trainer-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .trainer-logo {
            width: 50px;
            height: 50px;
            background: var(--primary-gradient);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .skill-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav
        style="padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; background: rgba(30,30,46,0.9); backdrop-filter: blur(10px);">
        <div style="display: flex; align-items: center; gap: 2rem;">
            <h2
                style="margin: 0; background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.8rem;">
                HireUp</h2>
            <div class="nav-links">
                <a href="candidate_dashboard.html"
                    style="color: var(--text-muted); text-decoration: none; margin-right: 1.5rem;">Dashboard</a>
                <a href="jobs.html" style="color: var(--text-muted); text-decoration: none; margin-right: 1.5rem;">Find
                    Jobs</a>
                <a href="courses.html" style="color: white; font-weight: bold; text-decoration: none;">Explore
                    Courses</a>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <button onclick="logout()" class="btn"
                style="background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); width: auto; padding: 0.5rem 1rem;">Logout</button>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-bottom: 2rem;">Upskill Your Career</h1>

        <div id="courses-feed">
            <p style="text-align: center; color: var(--text-muted);">Loading courses...</p>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        const API_CANDIDATE = 'http://localhost:5000/api/candidate';

        async function loadCourses() {
            try {
                const res = await fetch(`${API_CANDIDATE}/courses`, {
                    headers: { 'x-auth-token': localStorage.getItem('token') }
                });
                const courses = await res.json();

                const feed = document.getElementById('courses-feed');
                feed.innerHTML = '';

                if (courses.length === 0) {
                    feed.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No courses available at the moment.</p>';
                    return;
                }

                courses.forEach(course => {
                    const skillsHtml = course.skills_taught
                        ? course.skills_taught.map(s => `<span class="skill-tag">${s}</span>`).join('')
                        : '';

                    const enrollBtn = course.is_enrolled
                        ? `<button class="btn" disabled style="background: var(--text-muted); cursor: not-allowed; width: auto;">Enrolled</button>`
                        : `<button onclick="enroll('${course.course_id}')" class="btn" style="width: auto; padding: 0.75rem 2rem;">Enroll Now</button>`;

                    const div = document.createElement('div');
                    div.className = 'course-card';
                    div.innerHTML = `
                        <div class="header">
                            <div class="trainer-info">
                                <div class="trainer-logo">${course.trainer_name ? course.trainer_name.charAt(0) : 'T'}</div>
                                <div>
                                    <h3 style="margin: 0;">${course.title}</h3>
                                    <span style="color: var(--text-muted); font-size: 0.9rem;">${course.trainer_name || 'Individual Trainer'} â€¢ ${course.mode}</span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span style="display: block; font-weight: bold; color: #10b981;">${course.fee} BDT</span>
                                <small style="color: var(--text-muted);">${course.duration_days} Days</small>
                            </div>
                        </div>
                        
                        <p style="color: #e2e8f0; line-height: 1.6; margin-bottom: 1rem;">${course.description || 'No description provided.'}</p>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 1rem;">
                            <div class="skills-list">
                                ${skillsHtml}
                            </div>
                            ${enrollBtn}
                        </div>
                    `;


                    feed.appendChild(div);
                });

            } catch (err) {
                console.error(err);
                document.getElementById('courses-feed').innerHTML = '<p style="color: red; text-align: center;">Error loading courses.</p>';
            }
        }

        async function enroll(courseId) {
            try {
                const res = await fetch(`${API_CANDIDATE}/courses/${courseId}/enroll`, {
                    method: 'POST',
                    headers: { 'x-auth-token': localStorage.getItem('token') }
                });

                if (res.ok) {
                    alert('Enrolled successfully!');
                    loadCourses();
                } else {
                    const data = await res.json();
                    alert(data.message || 'Failed to enroll');
                }
            } catch (err) {
                console.error(err);
                alert('Server error');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadCourses();
        });
    </script>
</body>

</html>